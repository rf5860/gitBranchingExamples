# Branching

## Overview

Our current model is Git Flow. The proposal is a modification, removing the develop branch.

Example of current model:

`<IMAGE>`

Same commits, under the proposed model:

`<IMAGE>`

Separate to this, we need to a new branch. This is regardless of if we change models. This is to allow us to trigger builds from Jenkins.

`<IMAGE (NEW WITH BRANCH)>`

## Proposed Model - Master Only

One of the big advantages for Git Flow, is the tooling support. The below shows the equivalent commands under the new model, and the advantages motivating this change.

### Git Flow Command

The current model - [git-flow](http://nvie.com/posts/a-successful-git-branching-model/) - has tooling support that is convenient. Here is list of equivalent commands.

|         Git Flow Command         |                                                                                      Git Equivalent                                                                                      |                                                                                                                                                                                          New Model Commands                                                                                                                                                                                          |                                                                                                                                                                                                                                   Possible Alias                                                                                                                                                                                                                                   |                                                     Example of Using Alias                                                      |
| -------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| git flow init                    | <code>git init<br>git commit --allow-empty -m "Initial commit"<br>git checkout -b develop master                                                                                 </code> | <code>git init<br>git commit --allow-empty -m "Initial commit"<br>git checkout -b develop master                                                                                                                                                                                                                                                                                     </code>         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                 |
| git flow feature start FEATURE   | <code>git checkout -b feature/FEATURE develop                                                                                                                                    </code> | <code>git checkout -b feature/FEATURE [master&#124;integration/*&#124;release/*&#124;hotfix/*]                                                                                                                                                                                                                                                                                       </code>         | <code>git config --global alias.start-feature '!startFeature() { git checkout -b feature/\$1 ${\$2:-master}; }; startFeature'                                                                                                                                                                                                                                                                                                                    </code>                           | <code> git start-feature ENAB-1<br>git start-feature ENAB-1 release/1.0<br>git start-feature ENAB-1 integration/ENAB-1  </code> |
| git flow feature publish FEATURE | <code>git checkout feature/FEATURE<br>git push origin feature/FEATURE                                                                                                            </code> | <code>git push -u origin feature/FEATURE:feature/FEATURE                                                                                                                                                                                                                                                                                                                             </code>         | <code>git config --global alias.publish-feature '!publishFeature() { "git push -u origin feature/\${1}:feature/\$1" }; publishFeature'                                                                                                                                                                                                                                                                                                         </code>                             | <code>git publish-feature ENAB-1                                                                                        </code> |
| git flow feature finish FEATURE  | <code>git checkout feature/FEATURE<br>git pull<br>git merge --no-ff feature/FEATURE<br>git branch -d feature/FEATURE                                                             </code> | <code>N/A (Code is only pulled after review, via BitBucket)                                                                                                                                                                                                                                                                                                                          </code>         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                 |
| git flow release start VERSION   | <code>git checkout release/VERSION develop                                                                                                                                       </code> | <code>git checkout -b release/VERSION master                                                                                                                                                                                                                                                                                                                                         </code>         | <code>git config --global alias.release-start '!releaseStart() { git checkout release/\$1 master; };releaseStart '                                                                                                                                                                                                                                                                                                                              </code>                            | <code>git release-start 2.0                                                                                             </code> |
| git flow release publish VERSION | <code>git push origin release/VERSION:release/VERSION                                                                                                                            </code> | <code>git push origin release/VERSION:release/VERSION                                                                                                                                                                                                                                                                                                                                </code>         | <code>git config --global alias publish-release '!publishRelease() { git push origin release/\$1:release/\$1; } publishRelease '                                                                                                                                                                                                                                                                                                                 </code>                           | <code>git publish-release 1.0                                                                                           </code> |
| git flow release finish VERSION  | <code>git checkout master<br>git merge --no-ff hotfix/VERSION<br>git tag VERSION<br>git checkout develop<br>git merge --no-ff hotfix/VERSION<br>git branch -d hotfix/VERSION<br> </code> | <code>git checkout master && git pull && \\<br>git merge --no-edit --no-ff release/VERSION && \\<br>git tag VERSION && \\<br>git branch -d release/VERSION && \\<br>git push origin :release/VERSION && \\<br>git push --tags                                                                                                                                                              </code>   | <code>git config --global alias.release-finish '!\\<br>finishRelease() {<br>  git checkout master && git pull && git merge --no-edit --no-ff release/\$1;<br>git branch -d release/\$1 && git push origin :release/\$1;<br> }; finishRelease'                                                                                                                                                                                                      </code>                         | <code>git  release-finish 2.0                                                                                           </code> |
| git flow hotfix start VERSION    | <code>git checkout hotfix/VERSION develop                                                                                                                                        </code> | <code>git checkout -b hotfix/VERSION master                                                                                                                                                                                                                                                                                                                                         </code>          | <code>git config --global alias.hotfix-start '!hotfixStart() { git checkout hotfix/\$1 master; };hotfixStart '                                                                                                                                                                                                                                                                                                                              </code>                                | <code>git hotfix-start 2.0                                                                                              </code> |
| git flow hotfix finish VERSION   | <code>git checkout master<br>git merge --no-ff hotfix/VERSION<br>git tag VERSION<br>git checkout develop<br>git merge --no-ff hotfix/VERSION<br>git branch -d hotfix/VERSION     </code> | <code>relBr="\$(git branch \-r \-\-list "origin/release/*" &#124; sed \-e "sZ\\s\*origin\/ZZ" &#124; head -1)";<br>mergeIn() { git checkout \$1 && git pull && git merge --no-edit --no-ff \$2; };<br>mergeIn master hotfix/VERSION && git tag VERSION && \\<br>mergeIn \$relBr master && <br>git branch -d hotfix/VERSION && \\<br>git push origin :hotfix/VERSION && \\<br>git push --tags </code> | <code>git config --global alias.hotfix-finish '!\\<br>finishHotfix() {<br>relBr="\$(git branch -r --list "origin/release/*" &#124; sed \-e "sZ\\s\*origin/ZZ" &#124; head -1)";<br>  mergeIn() { git checkout \$1 && git pull && git merge --no-edit --no-ff \$2; };<br>  mergeIn master hotfix/\$1 <br>  if &#91;&#91; -n \$relBr &#93;&#93;; then mergeIn \$relBr master; fi;<br>  git branch -d hotfix/\$1 && git push origin :hotfix/\$1;<br>}; finishHotfix'          </code> | <code>git hotfix-finish 1.2.3                                                                                                   |

### JGitFlow

In addition to regular Git Flow, we use [jgit-flow](https://bitbucket.org/atlassian/jgit-flow/src/develop/) in our Java projects to manage versioning. This is the list of equivalent commands under the new model.

|         JGit Flow Command          | Commands Run | Proposed Equivalents |
| ---------------------------------- | ------------ | -------------------- |
| mvn:jgitflow release start VERSION |              |                      |
| mvn:jgitflow release start         |              |                      |
| mvn:jgitflow hotfix start  VERSION |              |                      |
| mvn:jgitflow hotfix finish         |              |                      |


### advantages

There are several advantages to the proposed model (compared to the current). This is a list of those advantages, along with details on common issues experienced with the current model.

- Merge Conflicts
- Pom versioning
- Merge Targets